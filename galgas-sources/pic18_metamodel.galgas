

#---------------------------------------------------------------------------*
#                                                                           *
#    B O O T L O A D E R   R E S E R V E D   R A M    M A P                 *
#                                                                           *
#---------------------------------------------------------------------------*

map @bootloaderReservedRAMmap {
  public var @luint mReservedSize
  %insertSetter insertKey %errorMessage "the reserved size for the '%K' bank is already declared"
  %searchMethod searchKey %errorMessage "the reserved size for the '%K' bank is not declared"
}

#----------------------------------------------------*

abstract refclass @pic18PiccoloInstruction {
  public var @location mInstructionLocation
}

#----------------------------------------------------*

list @pic18InstructionList {
  public var @pic18PiccoloInstruction mInstruction
}

#----------------------------------------------------*

refclass @pic18Instruction_nobanksel : @pic18PiccoloInstruction {
}

#----------------------------------------------------*

refclass @pic18Instruction_checknobank : @pic18PiccoloInstruction {
}

#----------------------------------------------------*

refclass @pic18Instruction_checkbank : @pic18PiccoloInstruction {
  public var @uint mBankIndex
}

#----------------------------------------------------*

abstract refclass @pic18PiccoloSimpleInstruction : @pic18PiccoloInstruction {
}

#----------------------------------------------------*

refclass @pic18Instruction_banksel : @pic18PiccoloInstruction {
  public var @luint mBankIndex
  public var @bool mWarningOnUselessBanksel
}

#----------------------------------------------------*

refclass @pic18Instruction_banksel_register : @pic18PiccoloInstruction {
  public var @registerExpression mRegisterExpression
  public var @bool mWarningOnUselessBanksel
}

#----------------------------------------------------*

refclass @pic18Instruction_savebank : @pic18PiccoloInstruction {
  public var @registerExpression mRegister
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfSaveBankInstruction
}

#----------------------------------------------------*

refclass @pic18Instruction_repetitionStatique : @pic18PiccoloInstruction {
  public var @lstring mConstantName
  public var @immediatExpression mLowerBoundExpression
  public var @immediatExpression mUpperBoundExpression
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfInstruction
}

#----------------------------------------------------*

#!Block Instruction

#----------------------------------------------------*

abstract refclass @abstractBlockTerminationForBlockInstruction {
}

#----------------------------------------------------*

refclass @exitBlockTerminationForBlockInstruction : @abstractBlockTerminationForBlockInstruction {
  public var @location mLocation
}

#----------------------------------------------------*

refclass @gotoTerminationForBlockInstruction : @abstractBlockTerminationForBlockInstruction {
  public var @lstring mNextBlock
}

#----------------------------------------------------*

refclass @testTerminationForBlockInstruction : @abstractBlockTerminationForBlockInstruction {
  public var @pic18ConditionExpression mCondition
  public var @abstractBlockTerminationForBlockInstruction mTrueTermination
  public var @abstractBlockTerminationForBlockInstruction mFalseTermination
  public var @location mLocation
}

#----------------------------------------------------*

list @pic18BlockInstructionBlockList {
  public var @lstring mBlockName
  public var @pic18InstructionList mInstructionList
  public var @abstractBlockTerminationForBlockInstruction mBlockTerminaisonForBlockInstruction
  public var @location mEndOfBlock
}

#----------------------------------------------------*

refclass @pic18Instruction_block : @pic18PiccoloInstruction {
  public var @lstring mStartBlockName
  public var @pic18BlockInstructionBlockList mBlockList
  public var @location mEndOfBlockInstruction
}

#----------------------------------------------------*

#!Switch instruction

#----------------------------------------------------*

abstract refclass @pic18AbstractCaseItem {
}

#----------------------------------------------------*

enum @pic18Instruction_FDA_base_code_AST {
  case ADDWF  case ADDWFC  case ANDWF  case COMF  case DECF  case INCF 
  case IORWF  case MOVF  case RLCF  case RLNCF  case RRCF  case RRNCF
  case SUBFWB  case SUBWF  case SUBWFB  case SWAPF  case XORWF
}

#----------------------------------------------------*

refclass @pic18Instruction_FDA : @pic18PiccoloSimpleInstruction {
  public var @pic18Instruction_FDA_base_code_AST mInstruction_FDA_base_code
  public var @registerExpression mRegisterExpression
  public var @bool m_W_isDestination
}

#----------------------------------------------------*

enum @FA_instruction_base_code {
  case CLRF  case CPFSEQ  case CPFSGT  case CPFSLT  case MOVWF  case MULWF  case NEGF  case SETF  case TSTFSZ
}

#----------------------------------------------------*

refclass @pic18Instruction_FA : @pic18PiccoloSimpleInstruction {
  public var @FA_instruction_base_code mFAinstruction
  public var @registerExpression mRegisterExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_MOVFF : @pic18PiccoloSimpleInstruction {
  public var @registerExpression mSourceRegisterName
  public var @registerExpression mDestinationRegisterName
}

#----------------------------------------------------*

enum @bit_oriented_op {
  case BCF  case BSF  case BTG
}

#----------------------------------------------------*

refclass @pic18Instruction_FBA : @pic18PiccoloSimpleInstruction {
  public var @bit_oriented_op mBitOrientedOp
  public var @registerExpression mRegisterExpression
  public var @bitNumberExpression mBitNumber
}

#----------------------------------------------------*

enum @conditional_branch {
  case bz  case bnz  case bn  case bnn  case bc  case bnc  case bov  case bnov
}

#----------------------------------------------------*

enum @jumpInstructionKind {
  case ipicRelative
  case relative
  case absolute
}

#----------------------------------------------------*

refclass @pic18Instruction_JSR : @pic18PiccoloSimpleInstruction {
  public var @lstring mTargetLabel
  public var @jumpInstructionKind mKind
}

#----------------------------------------------------*

refclass @pic18Instruction_macro : @pic18PiccoloInstruction {
  public var @lstring mMacroName
  public var @immediatExpressionList mExpressionList
}

#----------------------------------------------------*

refclass @pic18Instruction_JUMP : @pic18PiccoloInstruction {
  public var @lstring mTargetLabel
  public var @jumpInstructionKind mKind
}

#----------------------------------------------------*

refclass @pic18Instruction_JUMPCC : @pic18PiccoloInstruction {
  public var @lstring mTargetLabel
  public var @conditional_branch mConditionalBranch
  public var @bool mIsBcc
}

#----------------------------------------------------*

enum @pic18InstructionWithNoOperandKind {
  case CLRWDT 
  case DAW 
  case NOP 
  case POP 
  case PUSH 
  case RESET 
  case SLEEP
}

#----------------------------------------------------*

refclass @pic18Instruction_withNoOperand : @pic18PiccoloSimpleInstruction {
  public var @pic18InstructionWithNoOperandKind mKind
}

#----------------------------------------------------*

enum @literal_instruction_opcode {
  case ADDLW  case ANDLW  case IORLW  case MOVLW  case MULLW  case SUBLW  case XORLW
}

#----------------------------------------------------*

refclass @pic18Instruction_literalOperation : @pic18PiccoloSimpleInstruction {
  public var @literal_instruction_opcode mLiteralInstruction
  public var @immediatExpression mImmediatExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_fnop : @pic18PiccoloSimpleInstruction {
  public var @immediatExpression mImmediatExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_LFSR : @pic18PiccoloSimpleInstruction {
  public var @luint mFSRindex
  public var @immediatExpression mImmediatExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_LTBLPTR : @pic18PiccoloInstruction {
  public var @immediatExpression mImmediatExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_LDATA8PTR : @pic18PiccoloInstruction {
  public var @lstring mDataName
  public var @luint mDataIndex
}

#----------------------------------------------------*

refclass @pic18Instruction_LDATA16PTR : @pic18PiccoloInstruction {
  public var @lstring mDataName
  public var @luint mDataIndex
}

#----------------------------------------------------*

enum @tableAccessOption {
  case simpleAccess  case postIncrement  case postDecrement  case preIncrement
}

#----------------------------------------------------*

refclass @pic18Instruction_TBLRD : @pic18PiccoloSimpleInstruction {
  public var @tableAccessOption mOption
}

#----------------------------------------------------*

refclass @pic18Instruction_TBLWT : @pic18PiccoloSimpleInstruction {
  public var @tableAccessOption mOption
}

#----------------------------------------------------*

refclass @pic18Instruction_MNOP : @pic18PiccoloInstruction {
  public var @luint mOccurrenceFactor
}

#----------------------------------------------------*

refclass @pic18Instruction_NOPBRA : @pic18PiccoloInstruction {
  public var @luint mOccurrenceFactor
}

#----------------------------------------------------*

refclass @pic18Instruction_FOREVER : @pic18PiccoloInstruction {
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfInstructionList
}

#----------------------------------------------------*

enum @if_semi_colon_op {
  case CPFSEQ  case CPFSGT  case CPFSLT  case TSTFSZ
}

#----------------------------------------------------*

abstract refclass @pic18Instruction_IF_SEMI_COLON : @pic18PiccoloInstruction {
  public var @pic18PiccoloSimpleInstruction mEmbeddedInstruction
}

#----------------------------------------------------*

refclass @pic18Instruction_IF_FA_SEMI_COLON : @pic18Instruction_IF_SEMI_COLON {
  public var @if_semi_colon_op mOpCode
  public var @registerExpression mRegisterExpression
}

#----------------------------------------------------*

refclass @pic18Instruction_IF_BitTest : @pic18Instruction_IF_SEMI_COLON {
  public var @bool mSkipIfSet
  public var @registerExpression mRegisterExpression
  public var @bitNumberExpression mBitNumber
}

#----------------------------------------------------*

refclass @pic18Instruction_IF_IncDec : @pic18Instruction_IF_SEMI_COLON {
  public var @bool mIncrement
  public var @bool mSkipIfZero
  public var @registerExpression mRegisterExpression
  public var @bool m_W_isDestination
}

#----------------------------------------------------*

refclass @pic18Instruction_computed_retlw : @pic18PiccoloInstruction {
  public var @immediatExpression mSizeExpression
  public var @immediatExpressionList mImmediateExpressionList
  public var @bool mUsesRelativeCall
}

#----------------------------------------------------*

refclass @pic18Instruction_computed_bra : @pic18PiccoloInstruction {
  public var @immediatExpression mSizeExpression
  public var @lstringlist mTargetLabels
  public var @bool mUsesRelativeCall
}

#----------------------------------------------------*

refclass @pic18Instruction_computed_goto : @pic18PiccoloInstruction {
  public var @immediatExpression mSizeExpression
  public var @lstringlist mTargetLabels
  public var @bool mUsesRelativeCall
}

#----------------------------------------------------*

refclass @pic18Instruction_computed_rcall : @pic18PiccoloInstruction {
  public var @immediatExpression mSizeExpression
  public var @lstringlist mTargetLabels
  public var @bool mUsesRelativeCall
}

#----------------------------------------------------*

abstract refclass @pic18ConditionExpression {
}

#----------------------------------------------------*

refclass @pic18RegisterTestCondition : @pic18ConditionExpression {
  public var @registerExpression mRegisterExpression
  public var @bool mBranchIfZero
}

#----------------------------------------------------*

enum @pic18RegisterComparison {
  case notEqual  case equal  case greaterOrEqual  case greater  case lowerOrEqual  case lower
}

#----------------------------------------------------*

refclass @pic18RegisterComparisonCondition : @pic18ConditionExpression {
  public var @registerExpression mRegisterExpression
  public var @pic18RegisterComparison mComparison
}

#----------------------------------------------------*

refclass @pic18IncDecRegisterInCondition : @pic18ConditionExpression {
  public var @registerExpression mRegisterExpression
  public var @bool mIncrement
  public var @bool m_W_isDestination
  public var @bool mBranchIfZero
}

#----------------------------------------------------*

refclass @pic18BccInStructuredCondition : @pic18ConditionExpression {
  public var @location mConditionLocation
  public var @conditional_branch mCondition
}

#----------------------------------------------------*

refclass @pic18NegateCondition : @pic18ConditionExpression {
  public var @pic18ConditionExpression mCondition
}

#----------------------------------------------------*

refclass @pic18AndCondition : @pic18ConditionExpression {
  public var @pic18ConditionExpression mLeftExpression
  public var @pic18ConditionExpression mRightExpression
}

#----------------------------------------------------*

refclass @pic18BitTestInStructuredCondition : @pic18ConditionExpression {
  public var @registerExpression mRegisterExpression
  public var @bitNumberExpression mBitNumber
#  @bool mBTFSSinstruction
}

#----------------------------------------------------*

refclass @pic18Instruction_structured_if : @pic18PiccoloInstruction {
  public var @pic18ConditionExpression mIfCondition
  public var @pic18InstructionList mThenInstructionList
  public var @pic18InstructionList mElseInstructionList
  public var @location mEndOfElsePartLocation
}

#----------------------------------------------------*

list @pic18DoWhilePartList {
  public var @pic18ConditionExpression mCondition
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfPartLocation
}

#----------------------------------------------------*

refclass @pic18Instruction_do_while : @pic18PiccoloInstruction {
  public var @pic18InstructionList mRepeatedInstructionList
  public var @location mEndOfRepeatedInstructionList
  public var @pic18DoWhilePartList mWhilePartList
}

#----------------------------------------------------*

list @pic18InterruptDefinitionList {
  public var @lstring mInterruptName
  public var @bool mFastReturn
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfInterruptLocation
}

#----------------------------------------------------*

list @pic18RoutineDefinitionList {
  public var @lstring mRoutineName
  public var @luint mRequiredBank
  public var @luint mReturnedBank
  public var @bool mPreservesBank
  public var @bool mIsNoReturn
  public var @pic18InstructionList mInstructionList
  public var @location mEndOfRoutineLocation
}

#----------------------------------------------------*

list @pic18MacroDefinitionList {
  public var @lstring mMacroName
  public var @lstringlist mConstantNameList
  public var @pic18InstructionList mInstructionList
}

#----------------------------------------------------*

map @pic18MacroMap {
  public var @lstringlist mConstantNameList
  public var @pic18InstructionList mInstructionList
  %insertSetter insertKey %errorMessage "the '%K' macro is already declared in %L"
  %searchMethod searchKey %errorMessage "there is no '%K' macro"
}

#----------------------------------------------------*

list @routineDeclarationList {
  public var @lstring mRoutineName
  public var @luint mRequiredBank
  public var @luint mReturnedBank
  public var @bool mPreservesBank
  public var @bool mIsNoReturn
}

#----------------------------------------------------*

enum @programKind {
  case regularProgram  case bootloaderProgram  case userProgram
}

#----------------------------------------------------*

list @dataList {
  public var @lstring mDataName
  public var @immediatExpressionList mValueList
  public var @bool mIsByteList # true: data8, false: data16
}

#----------------------------------------------------*

list @checkpicList {
  public var @location mErrorLocation
  public var @lstringlist mValueList
}

#----------------------------------------------------*

struct @pic18AST {
  public var @lstring mProgramName
  public var @programKind mProgramKind
  public var @lstring mDeviceNameOrBootLoaderReference
  public var @configDefinitionList mConfigDefinitionList
  public var @ramDefinitionList mRamDefinitionList
  public var @lstringlist mUnusedRegisterList
  public var @checkpicList mCheckpicList
  public var @dataList mDataList
  public var @pic18InterruptDefinitionList mInterruptDefinitionList
  public var @constantDefinitionList mConstantDefinitionList
  public var @pic18RoutineDefinitionList mRoutineDefinitionList
  public var @pic18MacroDefinitionList mMacroDefinitionList
  public var @lstringlist mUnusedRoutineList
  public var @lstringlist mInlinedRoutineList
  public var @bool mNeedsComputedGoto2
  public var @bool mNeedsComputedGoto4
  public var @location mEndOfProgram
}

#----------------------------------------------------*

