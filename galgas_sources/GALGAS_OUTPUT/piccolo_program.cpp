//---------------------------------------------------------------------------*
//                                                                           *
//                        File 'piccolo_program.cpp'                         *
//                 Generated by version GALGAS_BETA_VERSION                  *
//                    september 23th, 2010, at 16h3'54"                      *
//                                                                           *
//---------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

#include "version_libpm.h"
#if CURRENT_LIBPM_VERSION != VERSION_OF_LIBPM_USED_BY_GALGAS_COMPILER
  #error "This file has been compiled with a version of GALGAS that uses libpm version VERSION_OF_LIBPM_USED_BY_GALGAS_COMPILER, different than the current version (CURRENT_LIBPM_VERSION) of libpm"
#endif

//---------------------------------------------------------------------------*

#include "utilities/F_DisplayException.h"
#include "utilities/MF_MemoryControl.h"
#include "collections/TC_UniqueArray.h"
#include "command_line_interface/F_Analyze_CLI_Options.h"
#include "command_line_interface/mainForLIBPM.h"
#include "utilities/MF_MemoryControl.h"
#include "command_line_interface/C_StringCommandLineOption.h"
#include "utilities/cpp-allocation.h"
#include "utilities/basic-allocation.h"

#ifdef TARGET_API_MAC_CARBON
  #include <SIOUX.H>
#endif

#ifdef COMPILE_FOR_WIN32
  #ifdef __MWERKS__
    #include <WINSIOUX.H>
  #endif
#endif

#include <typeinfo>

//---------------------------------------------------------------------------*

#include "pic18_metamodel.h"
#include "pic18_semantics.h"
#include "piccolo_grammar.h"
#include "piccolo_program.h"

//---------------------------------------------------------------------------*

#ifndef DO_NOT_GENERATE_CHECKINGS
  #define SOURCE_FILE_AT_LINE(line) "piccolo_program.gProgram", line
  #define COMMA_SOURCE_FILE_AT_LINE(line) , SOURCE_FILE_AT_LINE(line)
#else
  #define SOURCE_FILE_AT_LINE(line) 
  #define COMMA_SOURCE_FILE_AT_LINE(line) 
#endif

//---------------------------------------------------------------------------*
//                                                                           *
//                     P R O G R A M    P R O L O G U E                      *
//                                                                           *
//---------------------------------------------------------------------------*

static void
piccolo_program_prologue (C_Compiler & inLexique,
                     const TC_UniqueArray <C_String> & /* inSourceFilesArray */) {
  const GGS_bool cond_3854 = (((gOption_piccolo_5F_options_outputDeviceList.reader_value ()).operator_or (gOption_piccolo_5F_options_outputPic_31__38_DeviceList.reader_value ())).operator_or (gOption_piccolo_5F_options_outputBaselineDeviceList.reader_value ())).operator_or (gOption_piccolo_5F_options_outputMidrangeDeviceList.reader_value ()) ;
  if (cond_3854.isBuiltAndTrue ()) {
    GGS_stringlist  var_cas_allDevices = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices).reader_allFilePathes (inLexique COMMA_SOURCE_FILE_AT_LINE (19)) ;
    GGS_stringlist  var_cas_pic18_devices = GGS_stringlist ::constructor_emptyList () ;
    GGS_stringlist  var_cas_midrange_devices = GGS_stringlist ::constructor_emptyList () ;
    GGS_stringlist  var_cas_baseline_devices = GGS_stringlist ::constructor_emptyList () ;
    GGS_bool var_cas_ok = GGS_bool (true) ;
    {
      GGS_stringlist::cEnumerator enumerator_1037 (var_cas_allDevices, true) ;
      const GGS_stringlist::cElement * operand_1037 = NULL ;
      while (((operand_1037 = enumerator_1037.nextObject ()))
          && (var_cas_ok.isBuiltAndTrue ())) {
        macroValidPointer (operand_1037) ;
        GGS_piccoloDeviceModel var_cas_piccoloDeviceModel ;
        GGS_string var_cas_name = operand_1037->mValue.reader_lastPathComponent ().reader_stringByDeletingPathExtension () ;
        ::routine_parseDeviceDefinition (inLexique,  GGS_lstring ::constructor_new (inLexique, var_cas_name, GGS_location (inLexique) COMMA_SOURCE_FILE_AT_LINE (28)),  var_cas_piccoloDeviceModel COMMA_SOURCE_FILE_AT_LINE (28)) ;
        switch (var_cas_piccoloDeviceModel.reader_mProcessorType (inLexique COMMA_SOURCE_FILE_AT_LINE (29)).enumValue ()) {
        case GGS_processorType::enum_pic18_60:
        case GGS_processorType::enum_pic18_80:
          {
          var_cas_pic18_devices.addAssign_operation (var_cas_name) ;
          }
          break ;
        case GGS_processorType::enum_midrange:
          {
          var_cas_midrange_devices.addAssign_operation (var_cas_name) ;
          const GGS_bool cond_1576 = (var_cas_piccoloDeviceModel.reader_mBankCount (inLexique COMMA_SOURCE_FILE_AT_LINE (32)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (32))).operator_strictSup (GGS_uint (4U)) ;
          if (cond_1576.isBuiltAndTrue ()) {
            inLexique.printMessage ((((var_cas_name).operator_concat (GGS_string (" has "))).operator_concat (var_cas_piccoloDeviceModel.reader_mBankCount (inLexique COMMA_SOURCE_FILE_AT_LINE (33)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (33)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (33)))).operator_concat (GGS_string (" banks\n")) COMMA_SOURCE_FILE_AT_LINE (33)) ;
          }
          }
          break ;
        case GGS_processorType::enum_baseline:
          {
          var_cas_baseline_devices.addAssign_operation (var_cas_name) ;
          }
          break ;
        case GGS_processorType::kNotBuilt:
          break ;
        }
      }
    }
    const GGS_bool cond_2641 = (gOption_piccolo_5F_options_outputDeviceList.reader_value ()).operator_or (gOption_piccolo_5F_options_outputBaselineDeviceList.reader_value ()) ;
    if (cond_2641.isBuiltAndTrue ()) {
      inLexique.printMessage ((((var_cas_baseline_devices.reader_length ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (50))).operator_concat (GGS_string (" baseline devices (not yet supported by Piccolo "))).operator_concat (GGS_string::constructor_stringWithVersionString (inLexique COMMA_SOURCE_FILE_AT_LINE (50)))).operator_concat (GGS_string ("):\n")) COMMA_SOURCE_FILE_AT_LINE (50)) ;
      GGS_uint  var_cas_idx = GGS_uint (0U) ;
      {
        GGS_stringlist::cEnumerator enumerator_2387 (var_cas_baseline_devices, true) ;
        const GGS_stringlist::cElement * operand_2387 = NULL ;
        while (((operand_2387 = enumerator_2387.nextObject ()))) {
          macroValidPointer (operand_2387) ;
          inLexique.printMessage (operand_2387->mValue.reader_stringByRightPadding (GGS_uint (15U), GGS_char (TO_UNICODE (' '))) COMMA_SOURCE_FILE_AT_LINE (53)) ;
          var_cas_idx.increment_operation (inLexique COMMA_SOURCE_FILE_AT_LINE (54)) ;
          const GGS_bool cond_2547 = (var_cas_idx).operator_isEqual (GGS_uint (5U)) ;
          if (cond_2547.isBuiltAndTrue ()) {
            var_cas_idx = GGS_uint (0U) ;
            inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (57)) ;
          }
        }
      }
      const GGS_bool cond_2628 = (var_cas_idx).operator_isNotEqual (GGS_uint (0U)) ;
      if (cond_2628.isBuiltAndTrue ()) {
        inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (61)) ;
      }
    }
    const GGS_bool cond_3247 = (gOption_piccolo_5F_options_outputDeviceList.reader_value ()).operator_or (gOption_piccolo_5F_options_outputMidrangeDeviceList.reader_value ()) ;
    if (cond_3247.isBuiltAndTrue ()) {
      inLexique.printMessage ((((var_cas_midrange_devices.reader_length ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (66))).operator_concat (GGS_string (" mid-range devices supported by Piccolo "))).operator_concat (GGS_string::constructor_stringWithVersionString (inLexique COMMA_SOURCE_FILE_AT_LINE (66)))).operator_concat (GGS_string (":\n")) COMMA_SOURCE_FILE_AT_LINE (66)) ;
      GGS_uint  var_cas_idx = GGS_uint (0U) ;
      {
        GGS_stringlist::cEnumerator enumerator_2993 (var_cas_midrange_devices, true) ;
        const GGS_stringlist::cElement * operand_2993 = NULL ;
        while (((operand_2993 = enumerator_2993.nextObject ()))) {
          macroValidPointer (operand_2993) ;
          inLexique.printMessage (operand_2993->mValue.reader_stringByRightPadding (GGS_uint (15U), GGS_char (TO_UNICODE (' '))) COMMA_SOURCE_FILE_AT_LINE (69)) ;
          var_cas_idx.increment_operation (inLexique COMMA_SOURCE_FILE_AT_LINE (70)) ;
          const GGS_bool cond_3153 = (var_cas_idx).operator_isEqual (GGS_uint (5U)) ;
          if (cond_3153.isBuiltAndTrue ()) {
            var_cas_idx = GGS_uint (0U) ;
            inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (73)) ;
          }
        }
      }
      const GGS_bool cond_3234 = (var_cas_idx).operator_isNotEqual (GGS_uint (0U)) ;
      if (cond_3234.isBuiltAndTrue ()) {
        inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (77)) ;
      }
    }
    const GGS_bool cond_3836 = (gOption_piccolo_5F_options_outputDeviceList.reader_value ()).operator_or (gOption_piccolo_5F_options_outputPic_31__38_DeviceList.reader_value ()) ;
    if (cond_3836.isBuiltAndTrue ()) {
      inLexique.printMessage ((((var_cas_pic18_devices.reader_length ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (82))).operator_concat (GGS_string (" pic18 devices supported by Piccolo "))).operator_concat (GGS_string::constructor_stringWithVersionString (inLexique COMMA_SOURCE_FILE_AT_LINE (82)))).operator_concat (GGS_string (":\n")) COMMA_SOURCE_FILE_AT_LINE (82)) ;
      GGS_uint  var_cas_idx = GGS_uint (0U) ;
      {
        GGS_stringlist::cEnumerator enumerator_3582 (var_cas_pic18_devices, true) ;
        const GGS_stringlist::cElement * operand_3582 = NULL ;
        while (((operand_3582 = enumerator_3582.nextObject ()))) {
          macroValidPointer (operand_3582) ;
          inLexique.printMessage (operand_3582->mValue.reader_stringByRightPadding (GGS_uint (15U), GGS_char (TO_UNICODE (' '))) COMMA_SOURCE_FILE_AT_LINE (85)) ;
          var_cas_idx.increment_operation (inLexique COMMA_SOURCE_FILE_AT_LINE (86)) ;
          const GGS_bool cond_3742 = (var_cas_idx).operator_isEqual (GGS_uint (5U)) ;
          if (cond_3742.isBuiltAndTrue ()) {
            var_cas_idx = GGS_uint (0U) ;
            inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (89)) ;
          }
        }
      }
      const GGS_bool cond_3823 = (var_cas_idx).operator_isNotEqual (GGS_uint (0U)) ;
      if (cond_3823.isBuiltAndTrue ()) {
        inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (93)) ;
      }
    }
  }
  const GGS_bool cond_4557 = (gOption_piccolo_5F_options_exportDeviceFiles.reader_value ().reader_length ()).operator_strictSup (GGS_uint (0U)) ;
  if (cond_4557.isBuiltAndTrue ()) {
    GGS_string var_cas_dir = gOption_piccolo_5F_options_exportDeviceFiles.reader_value () ;
    const GGS_bool cond_4156 = (var_cas_dir.reader_directoryExists ()).operator_not () ;
    if (cond_4156.isBuiltAndTrue ()) {
      if (var_cas_dir.isBuilt ()) {
        var_cas_dir (HERE)->method_makeDirectory (inLexique COMMA_SOURCE_FILE_AT_LINE (102)) ;
      }
    }
    GGS_filewrapper  var_cas_fw = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices) ;
    GGS_stringlist  var_cas_allDevices = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices).reader_allFilePathes (inLexique COMMA_SOURCE_FILE_AT_LINE (105)) ;
    {
      GGS_stringlist::cEnumerator enumerator_4317 (var_cas_allDevices, true) ;
      const GGS_stringlist::cElement * operand_4317 = NULL ;
      while (((operand_4317 = enumerator_4317.nextObject ()))) {
        macroValidPointer (operand_4317) ;
        GGS_string var_cas_definitionString = var_cas_fw.reader_fileContentsAtPath (inLexique, operand_4317->mValue COMMA_SOURCE_FILE_AT_LINE (107)) ;
        if (var_cas_definitionString.isBuilt ()) {
          var_cas_definitionString (HERE)->method_writeToFile (inLexique, (var_cas_dir).operator_concat (operand_4317->mValue) COMMA_SOURCE_FILE_AT_LINE (108)) ;
        }
      }
    }
    inLexique.printMessage ((((var_cas_allDevices.reader_length ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (110))).operator_concat (GGS_string (" devices copied in '"))).operator_concat (var_cas_dir)).operator_concat (GGS_string ("' directory\n")) COMMA_SOURCE_FILE_AT_LINE (110)) ;
  }
  GGS_string var_cas_deviceForMemoryDescription = gOption_piccolo_5F_options_memoryDescription.reader_value () ;
  const GGS_bool cond_7011 = (var_cas_deviceForMemoryDescription.reader_length ()).operator_strictSup (GGS_uint (0U)) ;
  if (cond_7011.isBuiltAndTrue ()) {
    GGS_string var_cas_devicePath = ((GGS_string ("/")).operator_concat (var_cas_deviceForMemoryDescription)).operator_concat (GGS_string (".piccoloDevice")) ;
    const GGS_bool cond_6890 = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices).reader_fileExistsAtPath (inLexique, var_cas_devicePath COMMA_SOURCE_FILE_AT_LINE (116)) ;
    if (cond_6890.isBuiltAndTrue ()) {
      GGS_piccoloDeviceModel var_cas_piccoloDeviceModel ;
      ::routine_parseDeviceDefinition (inLexique,  GGS_lstring ::constructor_new (inLexique, var_cas_deviceForMemoryDescription, GGS_location (inLexique) COMMA_SOURCE_FILE_AT_LINE (118)),  var_cas_piccoloDeviceModel COMMA_SOURCE_FILE_AT_LINE (118)) ;
      GGS_uint  var_cas_totalRam = GGS_uint (0U) ;
      {
        GGS_ramBankTable::cEnumerator enumerator_5119 (var_cas_piccoloDeviceModel.reader_mRamBankTable (inLexique COMMA_SOURCE_FILE_AT_LINE (120)), true) ;
        const GGS_ramBankTable::cElement * operand_5119 = NULL ;
        while (((operand_5119 = enumerator_5119.nextObject ()))) {
          macroValidPointer (operand_5119) ;
          var_cas_totalRam = var_cas_totalRam.add_operation (inLexique, operand_5119->mInfo.mLastAddressPlusOne COMMA_SOURCE_FILE_AT_LINE (121)).substract_operation (inLexique, operand_5119->mInfo.mFirstFreeAddress COMMA_SOURCE_FILE_AT_LINE (121)) ;
        }
      }
      inLexique.printMessage ((var_cas_deviceForMemoryDescription).operator_concat (GGS_string (" device:\n")) COMMA_SOURCE_FILE_AT_LINE (123)) ;
      inLexique.printMessage (((((GGS_string ("  ")).operator_concat (var_cas_piccoloDeviceModel.reader_mRamBankTable (inLexique COMMA_SOURCE_FILE_AT_LINE (124)).reader_count ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (124)))).operator_concat (GGS_string (" RAM banks (total "))).operator_concat (var_cas_totalRam.reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (124)))).operator_concat (GGS_string (" bytes):\n")) COMMA_SOURCE_FILE_AT_LINE (124)) ;
      {
        GGS_ramBankTable::cEnumerator enumerator_5457 (var_cas_piccoloDeviceModel.reader_mRamBankTable (inLexique COMMA_SOURCE_FILE_AT_LINE (125)), true) ;
        const GGS_ramBankTable::cElement * operand_5457 = NULL ;
        while (((operand_5457 = enumerator_5457.nextObject ()))) {
          macroValidPointer (operand_5457) ;
          inLexique.printMessage (((((((((GGS_string ("    bank \"")).operator_concat (operand_5457->mKey)).operator_concat (GGS_string ("\" from "))).operator_concat (operand_5457->mInfo.mFirstFreeAddress.reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (126)))).operator_concat (GGS_string (" to "))).operator_concat (operand_5457->mInfo.mLastAddressPlusOne.substract_operation (inLexique, GGS_uint (1U) COMMA_SOURCE_FILE_AT_LINE (127)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (127)))).operator_concat (GGS_string (" ("))).operator_concat (operand_5457->mInfo.mLastAddressPlusOne.substract_operation (inLexique, operand_5457->mInfo.mFirstFreeAddress COMMA_SOURCE_FILE_AT_LINE (128)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (128)))).operator_concat (GGS_string (" bytes)")) COMMA_SOURCE_FILE_AT_LINE (126)) ;
          {
            GGS_uintlist::cEnumerator enumerator_5740 (operand_5457->mInfo.mMirrorOffsetList, true) ;
            const GGS_uintlist::cElement * operand_5740 = enumerator_5740.nextObject () ;
            if ((operand_5740 != NULL)) {
              inLexique.printMessage (GGS_string (", mirror at ") COMMA_SOURCE_FILE_AT_LINE (130)) ;
              bool _foreach_loop_5740 ;
              do{
                macroValidPointer (operand_5740) ;
                inLexique.printMessage (operand_5457->mInfo.mFirstFreeAddress.add_operation (inLexique, operand_5740->mValue COMMA_SOURCE_FILE_AT_LINE (131)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (131)) COMMA_SOURCE_FILE_AT_LINE (131)) ;
                operand_5740 = enumerator_5740.nextObject () ;
                _foreach_loop_5740 = ((operand_5740 != NULL)) ;
                if (_foreach_loop_5740) {
                  inLexique.printMessage (GGS_string (", ") COMMA_SOURCE_FILE_AT_LINE (132)) ;
                }
              }while (_foreach_loop_5740) ;
            }
          }
          inLexique.printMessage (GGS_string ("\n") COMMA_SOURCE_FILE_AT_LINE (134)) ;
        }
      }
      switch (var_cas_piccoloDeviceModel.reader_mProcessorType (inLexique COMMA_SOURCE_FILE_AT_LINE (136)).enumValue ()) {
      case GGS_processorType::enum_pic18_60:
      case GGS_processorType::enum_pic18_80:
        {
        inLexique.printMessage (((GGS_string ("  ROM size: ")).operator_concat (var_cas_piccoloDeviceModel.reader_mRomSize (inLexique COMMA_SOURCE_FILE_AT_LINE (138)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (138)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (138)))).operator_concat (GGS_string (" bytes\n")) COMMA_SOURCE_FILE_AT_LINE (138)) ;
        }
        break ;
      case GGS_processorType::enum_midrange:
        {
        GGS_uint  var_cas_pageCount = var_cas_piccoloDeviceModel.reader_mRomSize (inLexique COMMA_SOURCE_FILE_AT_LINE (140)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (140)).add_operation (inLexique, GGS_uint (2047U) COMMA_SOURCE_FILE_AT_LINE (140)).divide_operation (inLexique, GGS_uint (2048U) COMMA_SOURCE_FILE_AT_LINE (140)) ;
        GGS_string var_cas_s = GGS_string ("") ;
        const GGS_bool cond_6307 = (var_cas_pageCount).operator_strictSup (GGS_uint (1U)) ;
        if (cond_6307.isBuiltAndTrue ()) {
          var_cas_s = GGS_string ("s") ;
        }
        inLexique.printMessage (((((((GGS_string ("  ROM size: ")).operator_concat (var_cas_piccoloDeviceModel.reader_mRomSize (inLexique COMMA_SOURCE_FILE_AT_LINE (145)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (145)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (145)))).operator_concat (GGS_string (" instructions ("))).operator_concat (var_cas_pageCount.reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (146)))).operator_concat (GGS_string (" page"))).operator_concat (var_cas_s)).operator_concat (GGS_string (")\n")) COMMA_SOURCE_FILE_AT_LINE (145)) ;
        }
        break ;
      case GGS_processorType::enum_baseline:
        {
        inLexique.printMessage (((GGS_string ("  ROM size: ")).operator_concat (var_cas_piccoloDeviceModel.reader_mRomSize (inLexique COMMA_SOURCE_FILE_AT_LINE (148)).reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (148)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (148)))).operator_concat (GGS_string (" instructions\n")) COMMA_SOURCE_FILE_AT_LINE (148)) ;
        }
        break ;
      case GGS_processorType::kNotBuilt:
        break ;
      }
      const GGS_bool cond_6704 = (var_cas_piccoloDeviceModel.reader_mEepromSize (inLexique COMMA_SOURCE_FILE_AT_LINE (150))).operator_isEqual (GGS_uint (0U)) ;
      if (cond_6704.isBuiltAndTrue ()) {
        inLexique.printMessage (GGS_string ("  No EEPROM\n") COMMA_SOURCE_FILE_AT_LINE (151)) ;
      }else if (cond_6704.isBuiltAndFalse ()) {
        inLexique.printMessage (((((GGS_string ("  EEPROM size: ")).operator_concat (var_cas_piccoloDeviceModel.reader_mEepromSize (inLexique COMMA_SOURCE_FILE_AT_LINE (153)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (153)))).operator_concat (GGS_string (" bytes (at "))).operator_concat (var_cas_piccoloDeviceModel.reader_mEepromAddress (inLexique COMMA_SOURCE_FILE_AT_LINE (154)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (154)))).operator_concat (GGS_string (")\n")) COMMA_SOURCE_FILE_AT_LINE (153)) ;
      }
    }else if (cond_6890.isBuiltAndFalse ()) {
      GGS_location (inLexique).reader_location (inLexique COMMA_HERE).signalGGSSemanticError (inLexique, ((GGS_string ("The ")).operator_concat (var_cas_deviceForMemoryDescription)).operator_concat (GGS_string (" device is not supported or does not exist")) COMMA_SOURCE_FILE_AT_LINE (158)) ;
    }
  }
  GGS_string var_cas_deviceForRegistersDescription = gOption_piccolo_5F_options_registerDescription.reader_value () ;
  const GGS_bool cond_8126 = (var_cas_deviceForRegistersDescription.reader_length ()).operator_strictSup (GGS_uint (0U)) ;
  if (cond_8126.isBuiltAndTrue ()) {
    GGS_string var_cas_devicePath = ((GGS_string ("/")).operator_concat (var_cas_deviceForRegistersDescription)).operator_concat (GGS_string (".piccoloDevice")) ;
    const GGS_bool cond_8002 = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices).reader_fileExistsAtPath (inLexique, var_cas_devicePath COMMA_SOURCE_FILE_AT_LINE (164)) ;
    if (cond_8002.isBuiltAndTrue ()) {
      GGS_piccoloDeviceModel var_cas_piccoloDeviceModel ;
      ::routine_parseDeviceDefinition (inLexique,  GGS_lstring ::constructor_new (inLexique, var_cas_deviceForRegistersDescription, GGS_location (inLexique) COMMA_SOURCE_FILE_AT_LINE (166)),  var_cas_piccoloDeviceModel COMMA_SOURCE_FILE_AT_LINE (166)) ;
      inLexique.printMessage ((((var_cas_deviceForRegistersDescription).operator_concat (GGS_string (" has "))).operator_concat (var_cas_piccoloDeviceModel.reader_mRegisterTable (inLexique COMMA_SOURCE_FILE_AT_LINE (167)).reader_count ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (167)))).operator_concat (GGS_string (" special registers:\n")) COMMA_SOURCE_FILE_AT_LINE (167)) ;
      {
        GGS_registerTable::cEnumerator enumerator_7703 (var_cas_piccoloDeviceModel.reader_mRegisterTable (inLexique COMMA_SOURCE_FILE_AT_LINE (168)), true) ;
        const GGS_registerTable::cElement * operand_7703 = NULL ;
        while (((operand_7703 = enumerator_7703.nextObject ()))) {
          macroValidPointer (operand_7703) ;
          GGS_string var_cas_s = ((GGS_string ("  '")).operator_concat (operand_7703->mKey)).operator_concat (GGS_string ("' at ")) ;
          {
            GGS_uintlist::cEnumerator enumerator_7823 (operand_7703->mInfo.mRegisterAddressList, true) ;
            const GGS_uintlist::cElement * operand_7823 = enumerator_7823.nextObject () ;
            if ((operand_7823 != NULL)) {
              bool _foreach_loop_7823 ;
              do{
                macroValidPointer (operand_7823) ;
                var_cas_s.dotAssign_operation (operand_7823->mValue.reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (171))) ;
                operand_7823 = enumerator_7823.nextObject () ;
                _foreach_loop_7823 = ((operand_7823 != NULL)) ;
                if (_foreach_loop_7823) {
                  var_cas_s.appendCString (", ") ;
                }
              }while (_foreach_loop_7823) ;
            }
          }
          var_cas_s.dotAssign_operation (operand_7703->mInfo.mBitDefinitionString) ;
          var_cas_s.appendCString ("\n") ;
          inLexique.printMessage (var_cas_s COMMA_SOURCE_FILE_AT_LINE (175)) ;
        }
      }
    }else if (cond_8002.isBuiltAndFalse ()) {
      GGS_location (inLexique).reader_location (inLexique COMMA_HERE).signalGGSSemanticError (inLexique, ((GGS_string ("The ")).operator_concat (var_cas_deviceForRegistersDescription)).operator_concat (GGS_string (" device is not supported or does not exist")) COMMA_SOURCE_FILE_AT_LINE (179)) ;
    }
  }
  GGS_string var_cas_deviceForConfigDescription = gOption_piccolo_5F_options_configDescription.reader_value () ;
  const GGS_bool cond_9810 = (var_cas_deviceForConfigDescription.reader_length ()).operator_strictSup (GGS_uint (0U)) ;
  if (cond_9810.isBuiltAndTrue ()) {
    GGS_string var_cas_devicePath = ((GGS_string ("/")).operator_concat (var_cas_deviceForConfigDescription)).operator_concat (GGS_string (".piccoloDevice")) ;
    const GGS_bool cond_9689 = GGS_filewrapper (gWrapperDirectory_0_embeddedDevices).reader_fileExistsAtPath (inLexique, var_cas_devicePath COMMA_SOURCE_FILE_AT_LINE (185)) ;
    if (cond_9689.isBuiltAndTrue ()) {
      GGS_piccoloDeviceModel var_cas_piccoloDeviceModel ;
      ::routine_parseDeviceDefinition (inLexique,  GGS_lstring ::constructor_new (inLexique, var_cas_deviceForConfigDescription, GGS_location (inLexique) COMMA_SOURCE_FILE_AT_LINE (187)),  var_cas_piccoloDeviceModel COMMA_SOURCE_FILE_AT_LINE (187)) ;
      inLexique.printMessage ((((var_cas_deviceForConfigDescription).operator_concat (GGS_string (" has "))).operator_concat (var_cas_piccoloDeviceModel.reader_mConfigRegisterMap (inLexique COMMA_SOURCE_FILE_AT_LINE (188)).reader_count ().reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (188)))).operator_concat (GGS_string (" configuration registers:\n")) COMMA_SOURCE_FILE_AT_LINE (188)) ;
      {
        GGS_configRegisterMap::cEnumerator enumerator_8815 (var_cas_piccoloDeviceModel.reader_mConfigRegisterMap (inLexique COMMA_SOURCE_FILE_AT_LINE (189)), true) ;
        const GGS_configRegisterMap::cElement * operand_8815 = NULL ;
        while (((operand_8815 = enumerator_8815.nextObject ()))) {
          macroValidPointer (operand_8815) ;
          GGS_string var_cas_s = ((((((GGS_string ("REGISTER '")).operator_concat (operand_8815->mKey)).operator_concat (GGS_string ("' at "))).operator_concat (operand_8815->mInfo.mRegisterAddress.reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (190)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (190)))).operator_concat (GGS_string (", width "))).operator_concat (operand_8815->mInfo.mRegisterWidth.reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (190)).reader_string (inLexique COMMA_SOURCE_FILE_AT_LINE (190)))).operator_concat (GGS_string ("\n")) ;
          {
            GGS_illegalMaskList::cEnumerator enumerator_9033 (operand_8815->mInfo.mIllegalMaskList, true) ;
            const GGS_illegalMaskList::cElement * operand_9033 = NULL ;
            while (((operand_9033 = enumerator_9033.nextObject ()))) {
              macroValidPointer (operand_9033) ;
              var_cas_s.appendCString ("  illegal value ") ;
              var_cas_s.dotAssign_operation (operand_9033->mIllegalValue.reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (192)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (192))) ;
              var_cas_s.appendCString (" mask ") ;
              var_cas_s.dotAssign_operation (operand_9033->mIllegalMask.reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (192)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (192))) ;
              var_cas_s.appendCString (" description \"") ;
              var_cas_s.dotAssign_operation (operand_9033->mDescription) ;
              var_cas_s.appendCString ("\"\n") ;
            }
          }
          {
            GGS_configRegisterMaskMap::cEnumerator enumerator_9257 (operand_8815->mInfo.mConfigRegisterMaskMap, true) ;
            const GGS_configRegisterMaskMap::cElement * operand_9257 = NULL ;
            while (((operand_9257 = enumerator_9257.nextObject ()))) {
              macroValidPointer (operand_9257) ;
              var_cas_s.appendCString ("  setting '") ;
              var_cas_s.dotAssign_operation (operand_9257->mKey) ;
              var_cas_s.appendCString ("': mask ") ;
              var_cas_s.dotAssign_operation (operand_9257->mInfo.mMaskValue.reader_uint (inLexique COMMA_SOURCE_FILE_AT_LINE (195)).reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (195))) ;
              var_cas_s.appendCString (" description \"") ;
              var_cas_s.dotAssign_operation (operand_9257->mInfo.mDescription) ;
              var_cas_s.appendCString ("\"\n") ;
              {
                GGS_fieldSettingMap::cEnumerator enumerator_9469 (operand_9257->mInfo.mFieldSettingMap, true) ;
                const GGS_fieldSettingMap::cElement * operand_9469 = NULL ;
                while (((operand_9469 = enumerator_9469.nextObject ()))) {
                  macroValidPointer (operand_9469) ;
                  var_cas_s.appendCString ("    value ") ;
                  var_cas_s.dotAssign_operation (operand_9469->mInfo.mValue.reader_hexString (inLexique COMMA_SOURCE_FILE_AT_LINE (197))) ;
                  var_cas_s.appendCString (" description \"") ;
                  var_cas_s.dotAssign_operation (operand_9469->mKey) ;
                  var_cas_s.appendCString ("\"\n") ;
                }
              }
            }
          }
          inLexique.printMessage (var_cas_s COMMA_SOURCE_FILE_AT_LINE (200)) ;
        }
      }
    }else if (cond_9689.isBuiltAndFalse ()) {
      GGS_location (inLexique).reader_location (inLexique COMMA_HERE).signalGGSSemanticError (inLexique, ((GGS_string ("The ")).operator_concat (var_cas_deviceForConfigDescription)).operator_concat (GGS_string (" device is not supported or does not exist")) COMMA_SOURCE_FILE_AT_LINE (204)) ;
    }
  }
}

//---------------------------------------------------------------------------*
//                                                                           *
//                     P R O G R A M    E P I L O G U E                      *
//                                                                           *
//---------------------------------------------------------------------------*

static void
piccolo_program_epilogue (C_Compiler & /* inLexique */,
                     const TC_UniqueArray <C_String> & /* inSourceFilesArray */) {
}

//---------------------------------------------------------------------------*
//                                                                           *
//                      M A I N    F O R    L I B P M                        *
//                                                                           *
//---------------------------------------------------------------------------*

int mainForLIBPM  (const int argc, const char * argv []) {
  bool verboseOptionOn = true ;
  PMSInt16 returnCode = 0 ; // No error
  {
  //--- Input/output parameters
    const char * extensions [] = {"piccolo", NULL} ;
    const char * helpMessages [] = {"a source text file with the .piccolo extension", NULL} ;
    TC_UniqueArray <C_String> sourceFilesArray ;
  //--- Analyze Command Line Options
    F_Analyze_CLI_Options (argc, argv,
                                 #ifndef DO_NOT_GENERATE_CHECKINGS
        "version PICCOLO_BETA_VERSION" " [debug]",
      #else
        "version PICCOLO_BETA_VERSION",
      #endif
                           sourceFilesArray,
                           extensions,
                           helpMessages) ;
  //--- Build galgas io object
    C_galgas_io * galgasIOptr = NULL ;
    macroMyNew (galgasIOptr, C_galgas_io (HERE)) ;
    C_Object::retain (galgasIOptr COMMA_HERE) ;
  //--- Common lexique object
    C_Compiler * commonLexique = NULL ;
    macroMyNew (commonLexique, C_Compiler (NULL, "", "", galgasIOptr COMMA_HERE)) ;
    C_Object::retain (commonLexique COMMA_HERE) ;
  //--- Ask Save On Close ? (Carbon and Windows SIOUX Only)
    #ifdef SIOUX_IS_IMPLEMENTED
      SIOUXSettings.asktosaveonclose = gOption_generic_5F_cli_5F_options_options_asktosaveonclose.mValue ;
    #endif
  //--- Enable 64 bit alloc debug ? Only if compiled in 64 bit and in debug mode
    #ifndef DO_NOT_GENERATE_CHECKINGS
      #ifdef __LP64__
        if (gOption_generic_5F_cli_5F_options_enable_5F_allocation_5F_debugging.mValue) {
          enableAllocDebugFor64BitTool () ;
        }
      #endif
    #endif
    try{
      verboseOptionOn = gOption_galgas_5F_cli_5F_options_verbose_5F_output.mValue ;
      piccolo_program_prologue (* commonLexique, sourceFilesArray) ;
      for (PMSInt32 i=0 ; i<sourceFilesArray.count () ; i++) {
        const C_String fileExtension = sourceFilesArray (i COMMA_HERE).pathExtension () ;
        PMSInt16 r = 0 ;
          if (fileExtension.compare ("piccolo") == 0) {
          C_Compiler & inLexique = * commonLexique ;
          const GGS_string source (true, sourceFilesArray (i COMMA_HERE)) ;
          const GGS_location _here (inLexique) ;
          const GGS_lstring var_cas_inSourceFile (GGS_lstring::constructor_new (inLexique, source, _here COMMA_HERE)) ;
            const GGS_string _depExtension = GGS_string ("") ;
            const GGS_string _depPath = GGS_string ("") ;
            if (_depExtension.isBuilt () && _depPath.isBuilt ()) {
              C_Grammar_piccolo_5F_grammar::_performSourceFileParsing_ (inLexique,
                                            _depExtension.string (),
                                            _depPath.string (),
                                            NULL,
                                            var_cas_inSourceFile
                                            COMMA_SOURCE_FILE_AT_LINE (213)) ;
            }
          if (verboseOptionOn) {
            co << "Analysis of '" << sourceFilesArray (i COMMA_HERE).lastPathComponent () << "' completed. " ;
            switch (commonLexique->totalErrorCount ()) {
            case 0 :
              co << "No error, " ;
              break ;
            case 1 :
              co << "1 error, " ;
              returnCode = 1 ; // Error code
              break ;
            default :
              co << cStringWithSigned (commonLexique->totalErrorCount ()) << " errors, " ;
              returnCode = 1 ; // Error code
              break ;
            }
            switch (commonLexique->totalWarningCount ()) {
            case 0 :
              co << "no warning" ;
              break ;
            case 1 :
              co << "1 warning" ;
              break ;
            default :
              co << cStringWithSigned (commonLexique->totalWarningCount ()) << " warnings" ;
              break ;
            }
            if (verboseOptionOn || ((commonLexique->totalErrorCount () + commonLexique->totalWarningCount ()) > 0)) {
              co << ".\n" ;
            }
          }
        }else{
          printf ("*** Error: unhandled extension for file '%s' ***\n", sourceFilesArray (i COMMA_HERE).cString (HERE)) ;
          r = 1 ;
        }
        if (r != 0) {
          returnCode = r ;
        }
      }
    //--- Error or warnings ?
      if (commonLexique->totalErrorCount () > 0) {
        returnCode = 1 ; // Error code
      }else if (commonLexique->totalWarningCount () > 0) {
        if (gOption_galgas_5F_cli_5F_options_treat_5F_warnings_5F_as_5F_error.mValue) {
          returnCode = 1 ; // Error code
          if (verboseOptionOn) {
            printf ("** Note: warnings are treated as errors. **\n") ;
          }
        }
      }
    //--- Epilogue
      piccolo_program_epilogue (* commonLexique, sourceFilesArray) ;
    }catch (const M_STD_NAMESPACE exception & e) {
      F_default_display_exception (e) ;
      returnCode = 1 ; // Error code
    }catch (...) {
      throw ;
    }
    macroReleaseObject (galgasIOptr) ;
    macroReleaseObject (commonLexique) ;
  }
  return returnCode ;
}

//--- START OF USER ZONE 2


//--- END OF USER ZONE 2


