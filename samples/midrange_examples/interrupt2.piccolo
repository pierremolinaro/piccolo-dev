# This program is just intended for checking
# interruption routine code generation
# Trying to execute it does not make sense.

# This program shows interrupt routine generation :
#  - for a midrange controller with common bank (gprnobnk)
#  - when code use several rom pages and interrupt routine
#    contains branch or call instruction(s).

# Saving interrupt context requires to declare two bytes in
# ram bank #0, and one byte in shared bank.

midrange interrupt2 "16F690" :

#----------------------------------------------------------------------------*
#                                                                            *
#                              RAM                                           *
#                                                                            *
#----------------------------------------------------------------------------*

ram gpr0 {
  byte itSave0 [2]
}

#----------------------------------------------------------------------------*

ram gprnobnk {
  byte itsave1
}

#----------------------------------------------------------------------------*
#                                                                            *
#                            INTERRUPT                                       *
#                                                                            *
#----------------------------------------------------------------------------*

interrupt contextsave itSave0, itsave1 {
  if (STATUS.C) 
    mnop 2
  end
}

#----------------------------------------------------------------------------*
#                                                                            *
#                                MAIN                                        *
#                                                                            *
#----------------------------------------------------------------------------*

noreturn routine main bank:requires 0 {
  forever
    jsr  routineInPage1
  end
}

#----------------------------------------------------------------------------*

routine routineInPage1 page 1 bank:preserved {
}

#----------------------------------------------------------------------------*

end